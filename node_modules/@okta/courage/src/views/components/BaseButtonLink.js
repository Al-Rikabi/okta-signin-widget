define(['underscore', 'shared/views/BaseView'], function (_, BaseView) {

  var disabledEvents = {
    click: function (e) {
      e.preventDefault();
      e.stopPropagation();
    }
  };

  return BaseView.extend({

    /**
     * @class BaseButtonLink
     * @extends Okta.View
     * @private
     * A configurable button.
     *
     * ```javascript
     * var View = BaseButtonLink.extend({
     *   title: 'Click Me',
     *   icon: 'help-text'
     * })
     * ```
     */

    /**
     * @property {String} [title] The main text for the button
     */

    /**
     * @property {String} [href] The link for the button
     */

    /**
     * @property {String} [icon]
     * CSS class for the icon to display. See [Style guide](http://rain.okta1.com:1802/su/dev/style-guide#icons)
     */

    /**
     * @property {Object} [events] a [Backbone events](http://backbonejs.org/#View-delegateEvents) hash
     */

    tagName: 'a',

    template: '{{#if icon}}<span class="icon {{icon}}"></span>{{/if}}{{#if title}}{{title}}{{/if}}',

    constructor: function (options) {
      this.attributes || (this.attributes = {});
      _.defaults(this.attributes, options && options.attributes || {}, {href: this.href || '#'});
      this.disabled = false;
      BaseView.apply(this, arguments);

      _.defaults(this.options, {title: this.title, icon: this.icon});

      this.$el.addClass('link-button');
      if (this.icon) {
        this.$el.addClass('link-button-icon');
      }
      if (!this.title && !this.options.title && this.icon) {
        this.$el.addClass('icon-only');
      }
    },

    enable: function () {
      this.toggle(true);
    },

    disable: function () {
      this.toggle(false);
    },

    toggle: function (enable) {
      this.disabled = !enable;
      this.$el.toggleClass('link-button-disabled', this.disabled);

      // delegateEvents asynchronously in case the button is not yet added to the DOM
      // in these cases the alternate events won't work
      _.defer(_.bind(function () {
        this.delegateEvents(this.disabled ? disabledEvents : null);
      }, this));
    }

  });

});
